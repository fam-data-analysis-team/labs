```{r setup, include = FALSE}
library(tidyverse)
library(here)

theme_set(
  theme_minimal() +
  theme(
    text = element_text(size = 14),
    plot.title = element_text(margin = margin(0, 0, 30, 0), hjust = 0.5),
    axis.title.x = element_text(margin = margin(20, 0, 0, 0)),
    axis.title.y = element_text(margin = margin(0, 10, 0, 0))
  )
)

dir.create(here("plots", "question3"), recursive = TRUE, showWarnings = FALSE)
```

# Завантаженя датасету з файлу

```{r}
df <- readRDS(here("data", "processed", "air_quality_tidy.RDS"))
```

# Залежність aqi від часу доби

```{r}
df_daytime <- df %>%
  mutate(
    daytime = factor(
      lubridate::hour(date) %/% 3,
      labels = c("00-03", "03-06", "06-09", "09-12", "12-15", "15-18", "18-21", "21-24")
    )
  )
```

Якість повітря трохи покращується у другій половині дня

```{r}
p <- df_daytime %>%
  ggplot(aes(x = daytime, y = log(aqi))) +
    geom_boxplot(na.rm = TRUE) +
    labs(x = "Інтервал часу (год)", title = "Зміна якості повітря впродовж доби")

ggsave(here("plots", "question3", "box.png"), p, bg = "white", dpi = 200)
```

Графіки для кожного county

```{r}
p <- df_daytime %>%
  ggplot(aes(x = daytime, y = log(aqi))) +
  geom_boxplot(na.rm = TRUE) +
  labs(
    x = "Інтервал часу (год)",
    title = "Зміна aqi впродовж доби"
  ) +
  facet_wrap(~county, ncol = 4, scales = "free") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.25))

ggsave(
  here("plots", "question3", "county-box.png"), 
  p, 
  width = 10,
  height = 15,
  bg = "white", dpi = 200
)
```